From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Ziggleflig <dmdinnc@gmail.com>
Date: Sun, 1 May 2022 00:46:53 -0400
Subject: [PATCH] Monumenta - Fix shulker NoAI allowing peeking


diff --git a/src/main/java/net/minecraft/world/entity/monster/Shulker.java b/src/main/java/net/minecraft/world/entity/monster/Shulker.java
index 9dedb3599d5388c1bcc34558e8e5cb4a8668646f..497722c5f3e9cdeded6b18e391316753b0581a58 100644
--- a/src/main/java/net/minecraft/world/entity/monster/Shulker.java
+++ b/src/main/java/net/minecraft/world/entity/monster/Shulker.java
@@ -83,6 +83,8 @@ public class Shulker extends AbstractGolem implements VariantHolder<Optional<Dye
     });
     private float currentPeekAmountO;
     private float currentPeekAmount;
+    private float initialPeekAmount;
+    private float initialPeekAmount0;
     @Nullable
     private BlockPos clientOldAttachPosition;
     private int clientSideTeleportInterpolation;
@@ -90,6 +92,8 @@ public class Shulker extends AbstractGolem implements VariantHolder<Optional<Dye
 
     public Shulker(EntityType<? extends Shulker> type, Level world) {
         super(type, world);
+        this.initialPeekAmount = this.currentPeekAmount;
+        this.initialPeekAmount0 = this.currentPeekAmountO;
         this.xpReward = 5;
         this.lookControl = new Shulker.ShulkerLookControl(this);
     }
@@ -177,7 +181,7 @@ public class Shulker extends AbstractGolem implements VariantHolder<Optional<Dye
     @Override
     public void tick() {
         super.tick();
-        if (!this.level.isClientSide && !this.isPassenger() && !this.canStayAt(this.blockPosition(), this.getAttachFace())) {
+        if (!this.level.isClientSide && !this.isPassenger() && !this.canStayAt(this.blockPosition(), this.getAttachFace()) && !this.isNoAi()) {
             this.findNewAttachment();
         }
 
@@ -237,6 +241,10 @@ public class Shulker extends AbstractGolem implements VariantHolder<Optional<Dye
     }
 
     private void onPeekAmountChange() {
+        if (this.isNoAi()) {
+            this.currentPeekAmount = this.initialPeekAmount;
+            this.currentPeekAmountO = this.initialPeekAmount0;
+        }
         this.reapplyPosition();
         float f = Shulker.getPhysicalPeek(this.currentPeekAmount);
         float f1 = Shulker.getPhysicalPeek(this.currentPeekAmountO);
